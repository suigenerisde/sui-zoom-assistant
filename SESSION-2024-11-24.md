# Zoom Assistant Session - 24.11.2024

## Status
**Bot verbindet sich erfolgreich zum Meeting und Socket-Server läuft.** Letzter Fix: Deepgram SDK v3 Parameter in `deepgram_service.py`.

## Architektur-Überblick
```
Frontend (Next.js) → Backend (FastAPI) → Zoom Bot (C++) → Deepgram
                          ↑                    ↓
                          └── Unix Socket ←────┘
                              /tmp/audio/meeting.sock
```

## Heute gelöste Probleme

### 1. Deepgram SDK v3 Kompatibilität
- `backend/services/transcription_service.py` - Imports und API aktualisiert
- `backend/services/deepgram_service.py` - `utterance_end_ms` → `endpointing=300`
- Entfernt: `vad_events=True` (nicht mehr unterstützt)

### 2. Socket-Architektur korrigiert
- **Problem**: Beide (Bot + Backend) waren Socket-Server
- **Lösung**: Bot = Server, Backend = Client
- `backend/services/zoom_bot_audio_service.py` - Komplett umgeschrieben als Client

### 3. Zoom Bot Fixes
- `zoom-bot/src/Config.cpp` - `--file` Parameter nicht mehr required für `-t`
- `zoom-bot/src/raw_record/ZoomSDKAudioRawDataDelegate.cpp` - Socket Server Start hinzugefügt
- `zoom-bot/src/util/SocketServer.cpp` + `.h` - Graceful handling wenn kein Client verbunden
- `zoom-bot/Dockerfile` - `libmeetingsdk.so.1` Symlink hinzugefügt

### 4. Frontend Fix
- `frontend/Dockerfile` - `ENV HOSTNAME=0.0.0.0` für Next.js standalone

## Test-Befehle

### 1. Container-Name finden
```bash
docker ps --filter "name=zoom-bot" --format "{{.Names}}"
```

### 2. Bot manuell starten
```bash
docker exec -it CONTAINER_NAME /bin/bash -c "cd /tmp/meeting-sdk-linux-sample && export LD_LIBRARY_PATH=./lib/zoomsdk && ./build/release/zoomsdk --client-id=\$ZOOM_CLIENT_ID --client-secret=\$ZOOM_CLIENT_SECRET --join-url='ZOOM_URL_HIER' RawAudio -t"
```

### 3. Backend-Join triggern (nachdem Bot läuft)
```bash
curl -X POST https://api.zoom-assistant.suimation.de/api/bot/join -H "Content-Type: application/json" -d '{"join_url": "ZOOM_URL_HIER"}' --max-time 30
```

### 4. Logs prüfen
```bash
docker logs $(docker ps -q --filter "name=backend") --tail 50
```

## Was funktioniert ✅
- Bot authentifiziert sich bei Zoom
- Bot tritt Meeting bei (erscheint als "Zoom Meeting Client")
- Bot startet Raw Recording
- Socket Server startet und wartet auf Verbindung
- Bot abonniert Raw Audio
- Volume-Sharing zwischen Containern (`/tmp/audio/meeting.sock` sichtbar)

## Nächster Schritt zum Testen
1. Deploy abwarten
2. Neuen Container-Namen finden
3. Bot manuell starten
4. curl oder Webseite zum Triggern
5. In Logs schauen: "Connected to Zoom Bot audio socket!" + Transcripts

## Offene Punkte
- [ ] End-to-End Test: Audio vom Bot → Backend → Deepgram → Transcript
- [ ] Frontend zeigt Transcripts an
- [ ] Automatischer Bot-Start via API

## Git Commits heute
```
ddc7b84 Fix Deepgram SDK v3 parameter in deepgram_service.py
27c642b Fix socket server to handle client connections gracefully
1d95c61 Start socket server for transcription and fix library symlink
d0586fa Fix socket architecture: Backend as client, make --file optional
```

## Wichtige Dateien
| Datei | Beschreibung |
|-------|-------------|
| `backend/services/zoom_bot_audio_service.py` | Socket Client - verbindet sich zum Bot |
| `backend/services/deepgram_service.py` | Deepgram Live Transcription |
| `zoom-bot/src/util/SocketServer.cpp` | Socket Server im Bot |
| `zoom-bot/src/raw_record/ZoomSDKAudioRawDataDelegate.cpp` | Audio → Socket |
