# Zoom Assistant Session - 24.11.2024

## Status
**Backend Deployment pending.** Letzter Fix: Deepgram SDK v3 synchrone Methoden (`await` entfernt bei `start()`, `send()`, `finish()`).

**Nächster Schritt:** Backend in Coolify redeployen, dann End-to-End Test.

## Architektur
```
Frontend (Next.js) → Backend (FastAPI) → Zoom Bot (C++) → Deepgram
                          ↑                    ↓
                          └── Unix Socket ←────┘
                              /tmp/audio/meeting.sock
```

## Gelöste Probleme

| Problem | Lösung | Datei |
|---------|--------|-------|
| Deepgram SDK v3 Imports | `DeepgramClient`, `LiveOptions`, `LiveTranscriptionEvents` | `transcription_service.py` |
| `utterance_end_ms` Parameter | → `endpointing=300` | `deepgram_service.py` |
| `vad_events` Parameter | Entfernt | `deepgram_service.py` |
| `UtteranceEnd` Event | Entfernt | `deepgram_service.py` |
| **SDK v3 async/sync** | `await` entfernt bei `start()`, `send()`, `finish()` | `deepgram_service.py` |
| Socket Server/Client Konflikt | Bot=Server, Backend=Client | `zoom_bot_audio_service.py` |
| `--file` required | Optional gemacht | `Config.cpp` |
| Socket Server nicht gestartet | `server.start()` im Konstruktor | `ZoomSDKAudioRawDataDelegate.cpp` |
| `exit()` bei write-Fehler | Graceful handling | `SocketServer.cpp` |
| `libmeetingsdk.so.1` fehlt | Symlink im Dockerfile | `Dockerfile` |
| Next.js Binding | `ENV HOSTNAME=0.0.0.0` | `frontend/Dockerfile` |

## Test-Befehle

```bash
# 1. Container-Name finden
docker ps --filter "name=zoom-bot" --format "{{.Names}}"

# 2. Bot starten (im zoom-bot Container)
docker exec -it CONTAINER_NAME /bin/bash -c "cd /tmp/meeting-sdk-linux-sample && export LD_LIBRARY_PATH=./lib/zoomsdk && ./build/release/zoomsdk --client-id=\$ZOOM_CLIENT_ID --client-secret=\$ZOOM_CLIENT_SECRET --join-url='ZOOM_URL' RawAudio -t"

# 3. Backend restart + Join
docker restart $(docker ps -q --filter "name=backend") && sleep 5 && curl -X POST https://api.zoom-assistant.suimation.de/api/bot/join -H "Content-Type: application/json" -d '{"join_url": "ZOOM_URL"}' --max-time 30

# 4. Logs prüfen
docker logs $(docker ps -q --filter "name=backend") --tail 30
```

## Erwartete Logs bei Erfolg
```
Bot joining meeting: ...
Connecting to Deepgram for meeting ...
Deepgram connection established
Attempting to connect to Zoom Bot socket
Connected to Zoom Bot audio socket!
[Deepgram] Final: <transcript text>
```

## Git Commits (neueste zuerst)
```
f9ceacb Fix Deepgram SDK v3 sync methods (remove await from start/send/finish)
8a251b9 Remove deprecated UtteranceEnd event from Deepgram service
ddc7b84 Fix Deepgram SDK v3 parameter in deepgram_service.py
27c642b Fix socket server to handle client connections gracefully
1d95c61 Start socket server for transcription and fix library symlink
d0586fa Fix socket architecture: Backend as client, make --file optional
```

## Offene Punkte
- [ ] **Backend redeployen** (Commit `f9ceacb` noch nicht live)
- [ ] End-to-End Test abschließen
- [ ] Frontend Transcript-Anzeige testen
- [ ] Automatischer Bot-Start via API implementieren

## Bekannte Fehler (wenn alte Version läuft)
```
Error connecting to Deepgram: object NoneType can't be used in 'await' expression
```
→ Fix ist im Commit `f9ceacb`, muss nur deployed werden.
