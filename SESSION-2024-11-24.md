# Zoom Assistant Session - 24.11.2024

## Status
**Bot verbindet sich erfolgreich zum Meeting**, aber die Audio-Übertragung zum Backend ist noch nicht vollständig getestet.

## Architektur-Überblick
```
Frontend (Next.js) → Backend (FastAPI) → Zoom Bot (C++) → Deepgram
                          ↑                    ↓
                          └── Unix Socket ←────┘
                              /tmp/audio/meeting.sock
```

## Heute gelöste Probleme

### 1. Deepgram SDK v3 Kompatibilität
- `backend/services/transcription_service.py` - Imports und API aktualisiert
- `LiveOptions` Parameter: `utterance_end_ms` → `endpointing=300`

### 2. Socket-Architektur korrigiert
- **Problem**: Beide (Bot + Backend) waren Socket-Server
- **Lösung**: Bot = Server, Backend = Client
- `backend/services/zoom_bot_audio_service.py` - Komplett umgeschrieben als Client

### 3. Zoom Bot Fixes
- `zoom-bot/src/Config.cpp` - `--file` Parameter nicht mehr required für `-t`
- `zoom-bot/src/raw_record/ZoomSDKAudioRawDataDelegate.cpp` - Socket Server wird jetzt gestartet
- `zoom-bot/src/util/SocketServer.cpp` + `.h` - Graceful handling wenn kein Client verbunden
- `zoom-bot/Dockerfile` - `libmeetingsdk.so.1` Symlink hinzugefügt

### 4. Frontend Fix
- `frontend/Dockerfile` - `ENV HOSTNAME=0.0.0.0` für Next.js standalone

## Aktueller Test-Befehl
```bash
# Container-Name finden
docker ps --filter "name=zoom-bot" --format "{{.Names}}"

# Bot starten (Container-Name anpassen!)
docker exec -it CONTAINER_NAME /bin/bash -c "cd /tmp/meeting-sdk-linux-sample && export LD_LIBRARY_PATH=./lib/zoomsdk && ./build/release/zoomsdk --client-id=\$ZOOM_CLIENT_ID --client-secret=\$ZOOM_CLIENT_SECRET --join-url='ZOOM_URL_HIER' RawAudio -t"
```

## Was funktioniert
- ✅ Bot authentifiziert sich bei Zoom
- ✅ Bot tritt Meeting bei (erscheint als "Zoom Meeting Client")
- ✅ Bot startet Raw Recording
- ✅ Socket Server startet (`listening on socket /tmp/audio/meeting.sock`)
- ✅ Bot abonniert Raw Audio

## Nächste Schritte zum Testen
1. Deploy abwarten
2. Bot manuell starten (siehe Befehl oben)
3. Prüfen ob Backend sich zum Socket verbindet:
   ```bash
   docker logs $(docker ps -q --filter "name=backend") --tail 50
   ```
4. Im Log sollte erscheinen: "Connected to Zoom Bot audio socket!"

## Wichtige Dateien
- `backend/services/zoom_bot_audio_service.py` - Socket Client
- `backend/services/deepgram_service.py` - Deepgram Integration
- `zoom-bot/src/util/SocketServer.cpp` - Socket Server
- `zoom-bot/src/raw_record/ZoomSDKAudioRawDataDelegate.cpp` - Audio Handling

## Offene Punkte
- [ ] End-to-End Test: Audio vom Bot → Backend → Deepgram → Transcript
- [ ] Frontend zeigt Transcripts an
- [ ] Automatischer Bot-Start via API (aktuell manuell)

## Git Commits heute
```
27c642b Fix socket server to handle client connections gracefully
1d95c61 Start socket server for transcription and fix library symlink
d0586fa Fix socket architecture: Backend as client, make --file optional
```
